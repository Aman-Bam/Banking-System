2026-02-17 09:05:33 [[32minfo[39m]: Email server is ready to send messages
FAIL tests/transaction.test.js (7.923 s)
  Transaction System
    Input Validation
      âˆš rejects missing fields (655 ms)
      âˆš rejects negative amount (279 ms)
      âˆš rejects same fromAccount and toAccount (285 ms)
    Ownership Enforcement
      Ã— blocks transfer from another user's account (542 ms)
    Insufficient Balance
      Ã— returns 400 when balance is too low (348 ms)
    Successful Transfer
      Ã— completes a valid transaction (323 ms)
    Idempotency
      Ã— returns 200 with original transaction on duplicate key (299 ms)
    Double-Spend Prevention (requires real replica set)
      Ã— only allows one of two concurrent transfers to succeed when balance is limited (289 ms)

  â— Transaction System â€º Ownership Enforcement â€º blocks transfer from another user's account

    expect(received).toMatch(expected)

    Expected pattern: /does not belong to you/
    Received string:  "Invalid fromAccount or insufficient permissions"

    [0m [90m 159 |[39m
     [90m 160 |[39m             expect(res[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)
    [31m[1m>[22m[39m[90m 161 |[39m             expect(res[33m.[39mbody[33m.[39mmessage)[33m.[39mtoMatch([35m/does not belong to you/[39m)
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 162 |[39m         })
     [90m 163 |[39m     })
     [90m 164 |[39m[0m

      at Object.toMatch (tests/transaction.test.js:161:38)

  â— Transaction System â€º Insufficient Balance â€º returns 400 when balance is too low

    expect(received).toMatch(expected)

    Expected pattern: /Insufficient balance/
    Received string:  "Insufficient funds"

    [0m [90m 184 |[39m
     [90m 185 |[39m             expect(res[33m.[39mstatus)[33m.[39mtoBe([35m400[39m)
    [31m[1m>[22m[39m[90m 186 |[39m             expect(res[33m.[39mbody[33m.[39mmessage)[33m.[39mtoMatch([35m/Insufficient balance/[39m)
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 187 |[39m         })
     [90m 188 |[39m     })
     [90m 189 |[39m[0m

      at Object.toMatch (tests/transaction.test.js:186:38)

  â— Transaction System â€º Successful Transfer â€º completes a valid transaction

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 400

    [0m [90m 210 |[39m                 })
     [90m 211 |[39m
    [31m[1m>[22m[39m[90m 212 |[39m             expect(res[33m.[39mstatus)[33m.[39mtoBe([35m201[39m)
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 213 |[39m             expect(res[33m.[39mbody[33m.[39mtransaction[33m.[39mstatus)[33m.[39mtoBe([32m"COMPLETED"[39m)
     [90m 214 |[39m
     [90m 215 |[39m             [90m// Verify balances[39m[0m

      at Object.toBe (tests/transaction.test.js:212:32)

  â— Transaction System â€º Idempotency â€º returns 200 with original transaction on duplicate key

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 400

    [0m [90m 245 |[39m                 [33m.[39msend(payload)
     [90m 246 |[39m
    [31m[1m>[22m[39m[90m 247 |[39m             expect(res1[33m.[39mstatus)[33m.[39mtoBe([35m201[39m)
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 248 |[39m
     [90m 249 |[39m             [90m// Second request â€” same key â€” should return 200[39m
     [90m 250 |[39m             [36mconst[39m res2 [33m=[39m [36mawait[39m request(app)[0m

      at Object.toBe (tests/transaction.test.js:247:33)

  â— Transaction System â€º Double-Spend Prevention (requires real replica set) â€º only allows one of two concurrent transfers to succeed when balance is limited

    expect(received).toBe(expected) // Object.is equality

    Expected: 100
    Received: 0

    [0m [90m 286 |[39m             [90m// Verify initial state[39m
     [90m 287 |[39m             [36mconst[39m initialBalance [33m=[39m [36mawait[39m ([36mawait[39m accountModel[33m.[39mfindById(fromAcc[33m.[39m_id))[33m.[39mbalance
    [31m[1m>[22m[39m[90m 288 |[39m             expect(initialBalance)[33m.[39mtoBe([35m100[39m)
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 289 |[39m
     [90m 290 |[39m             [36mconst[39m token [33m=[39m makeToken(user[33m.[39m_id)
     [90m 291 |[39m[0m

      at Object.toBe (tests/transaction.test.js:288:36)

Test Suites: 1 failed, 1 total
Tests:       5 failed, 3 passed, 8 total
Snapshots:   0 total
Time:        8.044 s
Ran all test suites matching tests/transaction.test.js.
Force exiting Jest: Have you considered using `--detectOpenHandles` to detect async operations that kept running after all tests finished?
